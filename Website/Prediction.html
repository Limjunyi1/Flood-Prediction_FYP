<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flood Prediction & Analysis</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="header-content">
            <h1>Flood Prediction & Analysis</h1>
        </div>
    </header>
    <section class="body-section">
        <div class="prediction-header">
            <h2>Prediction</h2>
        </div>
        <div class="option-box">
            <label for="option">Choose a location:</label>
            <select id="location" name="location">
                <option value="">Select Location</option>
            </select>
        </div>
        <form action="/action_page.php">
            <label for="birthday">Date:</label>
            <input type="date" id="date" name="date" min="" max="">
            <button type="submit" id="submit-btn">Submit</button>
        </form>
        <div class="container" id="dynamic-content">
        </div>
        <div class="data-preview-header">
            <h2>Data Preview</h2>
        </div>
        <div class="container"></div>
    </section>
    <footer>
        <div class="footer-content">
            <a href="../index.html" class="home-button"></a>
        </div>
    </footer>

    <script>
        const locations = ["Barisal", "Bhola", "Bogra", "Chandpur", "Chittagong (City-Ambagan)", "Chittagong (IAP-Patenga)", "Comilla", "Cox's Bazar", "Dhaka", "Dinajpur", "Faridpur", "Feni", "Hatiya", "Ishurdi", "Jessore", "Khepupara", "Khulna",  "Madaripur", "Maijdee Court", "Mongla", "Mymensingh", "Patuakhali", "Rajshahi", "Rangamati", "Rangpur", "Sandwip", "Satkhira", "Sitakunda",  "Sylhet", "Tangail", "Teknaf"];

        // Function to populate dropdown with locations
        function populateDropdown() {
            const locationDropdown = document.getElementById('location');
            locations.forEach(location => {
                const option = document.createElement('option');
                option.value = location;
                option.textContent = location;
                locationDropdown.appendChild(option);
            });
        }

        populateDropdown();

        // Function to get selected location
        function getSelectedLocation() {
            const locationDropdown = document.getElementById('location');
            const selectedLocation = locationDropdown.value;
            console.log('Selected location:', selectedLocation);
            return selectedLocation
        }

        document.getElementById('location').addEventListener('change', getSelectedLocation);

        // Function to get selected date
        function getSelectedDate() {
            const dateInput = document.getElementById('date');
            const selectedDate = dateInput.value;
            // Do something with the selected date
            console.log('Selected date:', selectedDate);
            return selectedDate;
        }

        document.getElementById('date').addEventListener('change', getSelectedDate);

        // Function to set min and max dates for the date input field
        function setMinMaxDate() {
            const dateInput = document.getElementById('date');
            const today = new Date();
            const maxDate = new Date(today);
            maxDate.setDate(today.getDate() + 14); 

            // Formatting date to YYYY-MM-DD format
            const formattedMaxDate = maxDate.toISOString().split('T')[0];
            const formattedToday = today.toISOString().split('T')[0];

            dateInput.setAttribute('min', formattedToday);
            dateInput.setAttribute('max', formattedMaxDate);
        }

        // Calling the function to set min and max dates on page load
        setMinMaxDate();

        // Function to handle form submission
        function handleFormSubmit(event) {
            event.preventDefault(); // Prevents the default form submission behavior
            
            const selectedLocation = getSelectedLocation();
            const selectedDate = getSelectedDate();
        
            // Your fetch request here
            fetch('http://127.0.0.1:5000/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    city: selectedLocation,
                    date: selectedDate
                })
            })
            .then(response => response.json())
            .then(prediction => {
                // Display prediction result
                document.getElementById('dynamic-content').innerHTML = 'Prediction Result: ' + JSON.stringify(prediction);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('dynamic-content').innerHTML = 'An error occurred.' + error;
            });
        }

        
        // Adding event listener to the submit button
        document.getElementById('submit-btn').addEventListener('click', handleFormSubmit);
    </script>
</body>
</html>
